name: ðŸ´ Registro de Fork

on:
  fork:

jobs:
  register-fork:
    name: Registrar participante que fez fork
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    
    steps:
      - name: ðŸ“¥ Checkout do repositÃ³rio
        uses: actions/checkout@v4
      
      - name: ðŸŽ‰ Criar Issue de boas-vindas para o participante
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const forker = context.payload.forkee.owner.login;
            const forkUrl = context.payload.forkee.html_url;
            const forkCreatedAt = context.payload.forkee.created_at;
            
            const issueBody = `## ðŸŽ‰ Novo Participante HDEV!
            
            **Participante:** @${forker}
            **Fork:** ${forkUrl}
            **Data:** ${forkCreatedAt}
            
            ---
            
            ### ðŸ“‹ PrÃ³ximos Passos
            
            OlÃ¡ @${forker}! Seja bem-vindo(a) Ã  comunidade HDEV! ðŸš€
            
            VocÃª acabou de fazer fork do **HDEV Hub**. Aqui estÃ¡ o que vocÃª precisa fazer:
            
            1. **ðŸ“š Acesse os desafios** no repositÃ³rio privado (se vocÃª tem acesso)
            2. **ðŸ’» Desenvolva sua soluÃ§Ã£o** seguindo as instruÃ§Ãµes do desafio
            3. **ðŸ“¤ Envie sua entrega** criando uma Issue com o template "ðŸš€ Enviar entrega do desafio"
            
            ---
            
            ### ðŸ… Sistema de ValidaÃ§Ã£o
            
            Quando vocÃª enviar sua entrega, nosso sistema irÃ¡ validar automaticamente:
            
            âœ… RepositÃ³rio existe  
            âœ… README presente  
            âœ… Tecnologias corretas (ex: SQLite)  
            âœ… Prints/GIFs no README  
            âœ… VÃ­deo demonstrativo  
            
            ---
            
            ### ðŸ†˜ Precisa de Ajuda?
            
            - Leia a documentaÃ§Ã£o completa no README
            - Abra uma Issue com suas dÃºvidas
            - Participe das discussÃµes da comunidade
            
            ---
            
            **Boa sorte e bom cÃ³digo! ðŸ’ª**
            
            _Esta Issue foi criada automaticamente pelo sistema HDEV._`;
            
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ðŸŽ‰ Novo participante: ${forker}`,
              body: issueBody,
              labels: ['participante', 'fork-automÃ¡tico']
            });
            
            console.log(`âœ… Issue de boas-vindas criada para @${forker}`);
      
      - name: ðŸ“Š Registrar fork em arquivo de participantes
        run: |
          mkdir -p participantes
          FORKER="${{ github.event.forkee.owner.login }}"
          FORK_URL="${{ github.event.forkee.html_url }}"
          TIMESTAMP=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
          
          echo "- **@${FORKER}** - [Fork](${FORK_URL}) - ${TIMESTAMP}" >> participantes/forks.md
          
          echo "âœ… Participante ${FORKER} registrado"
      
      - name: ðŸ’¾ Commit do registro (opcional)
        continue-on-error: true
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "HDEV Bot"
          git add participantes/forks.md
          git commit -m "ðŸŽ‰ Novo participante: ${{ github.event.forkee.owner.login }}"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}


