name: ğŸ Kit de Boas-Vindas DinÃ¢mico

on:
  fork:

jobs:
  welcome-kit:
    name: Gerar Kit de Boas-Vindas
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
      pull-requests: read
    
    steps:
      - name: ğŸ“¥ Checkout do repositÃ³rio
        uses: actions/checkout@v4
      
      - name: ğŸ‘¤ Obter informaÃ§Ãµes do perfil do GitHub
        id: user-info
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const forker = context.payload.forkee.owner.login;
            
            try {
              // Obter informaÃ§Ãµes do usuÃ¡rio
              const { data: user } = await github.rest.users.getByUsername({
                username: forker
              });
              
              // Obter informaÃ§Ãµes adicionais do perfil
              const name = user.name || forker;
              const bio = user.bio || 'Desenvolvedor(a) apaixonado(a) por tecnologia';
              const avatar = user.avatar_url;
              const profileUrl = user.html_url;
              const company = user.company || '';
              const location = user.location || '';
              const blog = user.blog || '';
              const publicRepos = user.public_repos || 0;
              const followers = user.followers || 0;
              const following = user.following || 0;
              const createdAt = user.created_at;
              
              // Calcular anos de experiÃªncia (aproximado)
              const accountAge = new Date() - new Date(createdAt);
              const yearsExperience = Math.floor(accountAge / (1000 * 60 * 60 * 24 * 365));
              
              // Determinar nÃ­vel sugerido baseado em repositÃ³rios pÃºblicos
              let suggestedLevel = 'Iniciante';
              if (publicRepos >= 20) {
                suggestedLevel = 'AvanÃ§ado';
              } else if (publicRepos >= 10) {
                suggestedLevel = 'IntermediÃ¡rio';
              }
              
              core.setOutput('name', name);
              core.setOutput('username', forker);
              core.setOutput('bio', bio);
              core.setOutput('avatar', avatar);
              core.setOutput('profileUrl', profileUrl);
              core.setOutput('company', company);
              core.setOutput('location', location);
              core.setOutput('blog', blog);
              core.setOutput('publicRepos', publicRepos.toString());
              core.setOutput('followers', followers.toString());
              core.setOutput('following', following.toString());
              core.setOutput('yearsExperience', yearsExperience.toString());
              core.setOutput('suggestedLevel', suggestedLevel);
              
              console.log(`âœ… InformaÃ§Ãµes obtidas para @${forker}`);
            } catch (error) {
              console.log(`âš ï¸ Erro ao obter informaÃ§Ãµes do usuÃ¡rio: ${error.message}`);
              // Valores padrÃ£o em caso de erro
              core.setOutput('name', forker);
              core.setOutput('username', forker);
              core.setOutput('bio', 'Desenvolvedor(a) apaixonado(a) por tecnologia');
              core.setOutput('avatar', '');
              core.setOutput('profileUrl', `https://github.com/${forker}`);
              core.setOutput('company', '');
              core.setOutput('location', '');
              core.setOutput('blog', '');
              core.setOutput('publicRepos', '0');
              core.setOutput('followers', '0');
              core.setOutput('following', '0');
              core.setOutput('yearsExperience', '0');
              core.setOutput('suggestedLevel', 'Iniciante');
            }
      
      - name: ğŸ“‚ Verificar pasta assets
        id: check-assets
        run: |
          if [ -d "assets" ]; then
            echo "âœ… Pasta assets encontrada"
            echo "exists=true" >> $GITHUB_OUTPUT
            
            # Listar arquivos na pasta assets
            if [ "$(ls -A assets 2>/dev/null)" ]; then
              echo "files=$(ls assets | tr '\n' ',' | sed 's/,$//')" >> $GITHUB_OUTPUT
            else
              echo "files=" >> $GITHUB_OUTPUT
            fi
          else
            echo "âš ï¸ Pasta assets nÃ£o encontrada"
            echo "exists=false" >> $GITHUB_OUTPUT
            echo "files=" >> $GITHUB_OUTPUT
          fi
      
      - name: ğŸ Criar Issue de Kit de Boas-Vindas
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const forker = context.payload.forkee.owner.login;
            const forkUrl = context.payload.forkee.html_url;
            const forkCreatedAt = new Date(context.payload.forkee.created_at).toLocaleDateString('pt-BR');
            
            // Obter informaÃ§Ãµes do step anterior
            const name = '${{ steps.user-info.outputs.name }}';
            const username = '${{ steps.user-info.outputs.username }}';
            const bio = '${{ steps.user-info.outputs.bio }}';
            const avatar = '${{ steps.user-info.outputs.avatar }}';
            const profileUrl = '${{ steps.user-info.outputs.profileUrl }}';
            const company = '${{ steps.user-info.outputs.company }}';
            const location = '${{ steps.user-info.outputs.location }}';
            const blog = '${{ steps.user-info.outputs.blog }}';
            const publicRepos = '${{ steps.user-info.outputs.publicRepos }}';
            const followers = '${{ steps.user-info.outputs.followers }}';
            const following = '${{ steps.user-info.outputs.following }}';
            const yearsExperience = '${{ steps.user-info.outputs.yearsExperience }}';
            const suggestedLevel = '${{ steps.user-info.outputs.suggestedLevel }}';
            const assetsExists = '${{ steps.check-assets.outputs.exists }}' === 'true';
            const assetsFiles = '${{ steps.check-assets.outputs.files }}';
            
            // Construir mensagem de boas-vindas personalizada
            let welcomeMessage = '# ğŸ‰ **Kit de Boas-Vindas DinÃ¢mico para a Comunidade HDEV**\n\n';
            welcomeMessage += `OlÃ¡, **${name}**!\n\n`;
            welcomeMessage += 'Seja muito bem-vindo(a) Ã  comunidade **HDEV | Desenvolvimento de Casa**! Estamos muito felizes em ter vocÃª conosco. Nosso objetivo Ã© criar um ambiente de aprendizado, colaboraÃ§Ã£o e crescimento mÃºtuo.\n\n';
            
            if (avatar) {
              welcomeMessage += `![Avatar](${avatar}&s=80)\n\n`;
            }
            
            welcomeMessage += `**Perfil GitHub:** [@${username}](${profileUrl})\n`;
            if (company) {
              welcomeMessage += `**Empresa:** ${company}\n`;
            }
            if (location) {
              welcomeMessage += `**LocalizaÃ§Ã£o:** ${location}\n`;
            }
            if (bio) {
              welcomeMessage += `**Bio:** ${bio}\n`;
            }
            if (blog) {
              welcomeMessage += `**Website:** ${blog}\n`;
            }
            
            welcomeMessage += '\n---\n\n';
            welcomeMessage += '## ğŸ“Š **Seu Perfil no GitHub**\n\n';
            welcomeMessage += `- ğŸ“¦ **RepositÃ³rios pÃºblicos:** ${publicRepos}\n`;
            welcomeMessage += `- ğŸ‘¥ **Seguidores:** ${followers}\n`;
            welcomeMessage += `- ğŸ‘¤ **Seguindo:** ${following}\n`;
            welcomeMessage += `- ğŸ“… **Conta criada hÃ¡:** ${yearsExperience} ano(s)\n`;
            welcomeMessage += `- ğŸ¯ **NÃ­vel sugerido:** **${suggestedLevel}**\n\n`;
            welcomeMessage += '---\n\n';
            welcomeMessage += '## ğŸš€ **Primeiros Passos Essenciais**\n\n';
            welcomeMessage += 'Para que vocÃª possa se integrar e aproveitar ao mÃ¡ximo tudo o que oferecemos, preparamos um guia rÃ¡pido com os primeiros passos essenciais:\n\n';
            welcomeMessage += '---\n\n';
            welcomeMessage += '### **ğŸ“ Passo 1: Atualize seu Perfil no LinkedIn**\n\n';
            welcomeMessage += 'Mostre a todos que vocÃª faz parte da nossa comunidade! Isso aumenta sua visibilidade e fortalece nosso grupo.\n\n';
            welcomeMessage += '*   **Adicione nosso banner oficial:** Personalize seu perfil com a nossa identidade visual.\n';
            welcomeMessage += '    *   ğŸ“¥ **Link para baixar o banner da HDEV:** ';
            if (assetsExists) {
              welcomeMessage += '[Clique aqui para acessar os assets](https://github.com/HDEV-Desenvolvimento-de-Casa/hdev-hub/tree/main/assets)\n';
            } else {
              welcomeMessage += 'Os assets estarÃ£o disponÃ­veis em breve na pasta `assets/` do repositÃ³rio\n';
            }
            
            if (assetsExists && assetsFiles) {
              welcomeMessage += '    *   **Arquivos disponÃ­veis:**\n';
              const files = assetsFiles.split(',');
              files.forEach(file => {
                welcomeMessage += `        - \`${file}\`\n`;
              });
            } else {
              welcomeMessage += '    *   _Pasta assets serÃ¡ criada em breve com os modelos para LinkedIn_\n';
            }
            
            welcomeMessage += '*   **Adicione a experiÃªncia em seu perfil:**\n';
            welcomeMessage += '    *   **Cargo:** Desenvolvedor Full Stack (VoluntÃ¡rio)\n';
            welcomeMessage += '    *   **Empresa:** HDEV | Desenvolvimento de Casa\n';
            welcomeMessage += '    *   **Tipo de emprego:** AutÃ´nomo\n';
            welcomeMessage += '    *   **Localidade:** Remota\n';
            welcomeMessage += '    *   **DescriÃ§Ã£o:** Sugerimos que vocÃª descreva os projetos em que estÃ¡ trabalhando e as tecnologias que estÃ¡ aprendendo conosco!\n\n';
            welcomeMessage += '    **ğŸ’¡ Dica:** Baseado no seu perfil GitHub, vocÃª pode destacar:\n';
            
            if (parseInt(publicRepos) > 0) {
              welcomeMessage += `    - ${publicRepos} projeto(s) desenvolvido(s)\n`;
            } else {
              welcomeMessage += '    - Seus projetos em desenvolvimento\n';
            }
            
            if (parseInt(yearsExperience) > 0) {
              welcomeMessage += `    - ${yearsExperience} ano(s) de experiÃªncia em desenvolvimento\n`;
            } else {
              welcomeMessage += '    - Sua jornada de aprendizado\n';
            }
            
            if (suggestedLevel !== 'Iniciante') {
              welcomeMessage += `    - NÃ­vel ${suggestedLevel} de conhecimento tÃ©cnico\n`;
            } else {
              welcomeMessage += '    - DedicaÃ§Ã£o ao crescimento profissional\n';
            }
            
            welcomeMessage += '\n---\n\n';
            welcomeMessage += '### **ğŸ‘¥ Passo 2: Junte-se Ã  nossa OrganizaÃ§Ã£o no GitHub**\n\n';
            welcomeMessage += 'O GitHub Ã© o nosso principal espaÃ§o para colaboraÃ§Ã£o em projetos de cÃ³digo aberto.\n\n';
            welcomeMessage += '*   **Aceite o convite:** VocÃª receberÃ¡ um convite por e-mail para se juntar Ã  nossa organizaÃ§Ã£o "HDEV-Desenvolvimento-de-Casa". Por favor, aceite-o para ter acesso aos nossos repositÃ³rios.\n';
            welcomeMessage += '    *   Se nÃ£o encontrar o convite, verifique sua caixa de spam ou acesse diretamente a pÃ¡gina da organizaÃ§Ã£o no GitHub.\n';
            welcomeMessage += '    *   **Link direto:** [HDEV-Desenvolvimento-de-Casa](https://github.com/HDEV-Desenvolvimento-de-Casa)\n\n';
            welcomeMessage += '---\n\n';
            welcomeMessage += '### **ğŸ”— Passo 3: Conecte-se e Participe!**\n\n';
            welcomeMessage += 'A interaÃ§Ã£o Ã© a chave para o sucesso da comunidade. Siga-nos em nossas redes e participe das discussÃµes.\n\n';
            welcomeMessage += '*   **Siga nossas redes sociais:**\n';
            welcomeMessage += '    *   **LinkedIn:** [Page](https://www.linkedin.com/company/hdev-desenvolvimento-de-casa/)\n';
            welcomeMessage += '    *   **YouTube:** [Canal](https://www.youtube.com/@hdevinfo)\n';
            welcomeMessage += '*   **Participe do nosso grupo no Whatsapp:**\n';
            welcomeMessage += '    *   [WhatsApp](https://chat.whatsapp.com/GwcomlxHICV1R74eXruWZX)\n\n';
            welcomeMessage += '---\n\n';
            welcomeMessage += '## ğŸ¯ **PrÃ³ximos Passos Recomendados**\n\n';
            welcomeMessage += 'Baseado no seu perfil, recomendamos:\n\n';
            welcomeMessage += '1. **ğŸ“š Explore os desafios disponÃ­veis:**\n';
            
            if (suggestedLevel === 'Iniciante') {
              welcomeMessage += '   - Comece pelos desafios **Iniciante** para fortalecer seus fundamentos\n';
            } else if (suggestedLevel === 'IntermediÃ¡rio') {
              welcomeMessage += '   - Explore os desafios **IntermediÃ¡rio** para expandir suas habilidades\n';
            } else {
              welcomeMessage += '   - Desafie-se com os projetos **AvanÃ§ado** e contribua com a comunidade\n';
            }
            
            welcomeMessage += '\n2. **ğŸ’» FaÃ§a seu primeiro fork:**\n';
            welcomeMessage += '   - VocÃª jÃ¡ fez fork do repositÃ³rio! ğŸ‰\n';
            welcomeMessage += '   - Agora explore os desafios disponÃ­veis e escolha um para comeÃ§ar\n\n';
            welcomeMessage += '3. **ğŸ“¤ Envie sua primeira entrega:**\n';
            welcomeMessage += '   - Desenvolva sua soluÃ§Ã£o seguindo as instruÃ§Ãµes do desafio\n';
            welcomeMessage += '   - Crie uma Issue com o template "ğŸš€ Enviar entrega do desafio"\n';
            welcomeMessage += '   - Nosso sistema validarÃ¡ automaticamente sua entrega\n\n';
            welcomeMessage += '---\n\n';
            welcomeMessage += '## ğŸ… **Sistema de Badges**\n\n';
            welcomeMessage += 'Ao completar desafios, vocÃª receberÃ¡ badges exclusivos que podem ser adicionados ao seu perfil:\n\n';
            welcomeMessage += '- ğŸ… Badge de ParticipaÃ§Ã£o\n';
            welcomeMessage += '- â­ Badge de Destaque\n';
            welcomeMessage += '- ğŸ–ï¸ Badges por Tecnologia\n\n';
            welcomeMessage += '---\n\n';
            welcomeMessage += '## ğŸ†˜ **Precisa de Ajuda?**\n\n';
            welcomeMessage += '- ğŸ“– Leia a documentaÃ§Ã£o completa no [README](../README.md)\n';
            welcomeMessage += '- ğŸ’¬ Abra uma Issue com suas dÃºvidas\n';
            welcomeMessage += '- ğŸ¤ Participe das discussÃµes da comunidade\n';
            welcomeMessage += '- ğŸ“§ Entre em contato atravÃ©s dos nossos canais\n\n';
            welcomeMessage += '---\n\n';
            welcomeMessage += '## ğŸ“‹ **InformaÃ§Ãµes do Fork**\n\n';
            welcomeMessage += `- **Data do fork:** ${forkCreatedAt}\n`;
            welcomeMessage += `- **Link do fork:** ${forkUrl}\n`;
            welcomeMessage += `- **Seu perfil:** [@${username}](${profileUrl})\n\n`;
            welcomeMessage += '---\n\n';
            welcomeMessage += 'Estamos ansiosos para ver suas contribuiÃ§Ãµes e seu crescimento! Se tiver qualquer dÃºvida, nÃ£o hesite em perguntar nos nossos canais de comunicaÃ§Ã£o.\n\n';
            welcomeMessage += '**Boa sorte e bem-vindo Ã  famÃ­lia HDEV! ğŸ’ªğŸš€**\n\n';
            welcomeMessage += '---\n\n';
            welcomeMessage += 'Atenciosamente,\n\n';
            welcomeMessage += '**A Equipe HDEV**\n\n';
            welcomeMessage += '---\n\n';
            welcomeMessage += '_ğŸ¤– Este kit de boas-vindas foi gerado automaticamente com base no seu perfil do GitHub._';

            // Criar a issue
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ğŸ Kit de Boas-Vindas para ${name} (@${username})`,
              body: welcomeMessage,
              labels: ['boas-vindas', 'kit-dinÃ¢mico', 'novo-membro']
            });
            
            console.log(`âœ… Kit de boas-vindas criado para @${username}`);
      
      - name: ğŸ“Š Registrar fork em arquivo de participantes
        run: |
          mkdir -p participantes
          FORKER="${{ steps.user-info.outputs.username }}"
          FORKER_NAME="${{ steps.user-info.outputs.name }}"
          FORK_URL="${{ github.event.forkee.html_url }}"
          TIMESTAMP=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
          
          # Adicionar ao arquivo de forks
          echo "- **@${FORKER}** (${FORKER_NAME}) - [Fork](${FORK_URL}) - ${TIMESTAMP}" >> participantes/forks.md
          
          echo "âœ… Participante ${FORKER} registrado"
      
      - name: ğŸ’¾ Commit do registro
        continue-on-error: true
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "HDEV Bot"
          git add participantes/forks.md
          git commit -m "ğŸ Novo membro: ${{ steps.user-info.outputs.name }} (@${{ steps.user-info.outputs.username }})"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
