name: ğŸ‘‹ Mensagem de Boas-vindas

on:
  issues:
    types: [opened]
  pull_request_target:
    types: [opened]

jobs:
  welcome:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write
    
    steps:
      - name: ğŸ‘‹ Mensagem para primeiro contribuidor
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const creator = context.payload.sender.login;
            
            // Verificar se Ã© primeira contribuiÃ§Ã£o
            let isFirstContribution = false;
            
            try {
              const { data: issues } = await github.rest.issues.listForRepo({
                owner: context.repo.owner,
                repo: context.repo.repo,
                creator: creator,
                state: 'all',
                per_page: 100
              });
              
              // Excluir a issue/PR atual
              const previousContributions = issues.filter(item => {
                if (context.eventName === 'issues') {
                  return item.number !== context.issue.number;
                } else {
                  return item.number !== context.payload.pull_request.number;
                }
              });
              
              isFirstContribution = previousContributions.length === 0;
            } catch (error) {
              console.log('Erro ao verificar contribuiÃ§Ãµes anteriores:', error.message);
            }
            
            // Se nÃ£o for primeira contribuiÃ§Ã£o, nÃ£o fazer nada
            if (!isFirstContribution) {
              console.log('NÃ£o Ã© primeira contribuiÃ§Ã£o. Pulando mensagem de boas-vindas.');
              return;
            }
            
            // Mensagem de boas-vindas
            let welcomeMessage = '';
            
            if (context.eventName === 'issues') {
              // Ã‰ uma Issue
              const isEntrega = context.payload.issue.labels.some(l => l.name === 'entrega');
              
              if (isEntrega) {
                welcomeMessage = [
                  '## ğŸ‰ Primeira Entrega!',
                  '',
                  `OlÃ¡ @${creator}! Seja muito bem-vindo(a) Ã  comunidade **HDEV**! ğŸš€`,
                  '',
                  'Esta Ã© sua **primeira entrega** e estamos muito felizes em tÃª-lo(a) aqui!',
                  '',
                  '---',
                  '',
                  '### ğŸ¤– O que acontece agora?',
                  '',
                  'Nosso sistema de validaÃ§Ã£o automÃ¡tica irÃ¡:',
                  '',
                  '1. âœ… Verificar se seu repositÃ³rio existe e Ã© acessÃ­vel',
                  '2. âœ… Validar a presenÃ§a de README',
                  '3. âœ… Confirmar uso das tecnologias especificadas',
                  '4. âœ… Checar prints/GIFs demonstrativos',
                  '5. âœ… Verificar vÃ­deo demonstrativo',
                  '',
                  '**Aguarde alguns segundos** e o resultado serÃ¡ comentado aqui automaticamente!',
                  '',
                  '---',
                  '',
                  '### ğŸ“š Recursos Ãšteis',
                  '',
                  '- ğŸ“– [DocumentaÃ§Ã£o de AutomaÃ§Ã£o](../AUTOMATION.md)',
                  '- ğŸ’¬ Participe das discussÃµes',
                  '- ğŸ… ApÃ³s aprovaÃ§Ã£o, vocÃª receberÃ¡ seu badge!',
                  '',
                  '---',
                  '',
                  '**Boa sorte e bem-vindo Ã  famÃ­lia HDEV! ğŸ’ª**'
                ].join('\n');
              } else {
                welcomeMessage = [
                  '## ğŸ‘‹ Primeira ContribuiÃ§Ã£o!',
                  '',
                  `OlÃ¡ @${creator}! Seja bem-vindo(a) Ã  comunidade **HDEV**!`,
                  '',
                  'Obrigado por abrir sua primeira Issue aqui. A equipe irÃ¡ revisar em breve!',
                  '',
                  '---',
                  '',
                  '### ğŸ’¡ Dicas',
                  '',
                  '- Se for reportar um problema, forneÃ§a o mÃ¡ximo de detalhes possÃ­vel',
                  '- Se for uma dÃºvida, nÃ£o hesite em perguntar',
                  '- Se for uma sugestÃ£o, adorarÃ­amos ouvir suas ideias!',
                  '',
                  '---',
                  '',
                  '**Obrigado por fazer parte da HDEV! ğŸš€**'
                ].join('\n');
              }
              
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                body: welcomeMessage
              });
              
            } else if (context.eventName === 'pull_request_target') {
              // Ã‰ um Pull Request
              welcomeMessage = [
                '## ğŸ‰ Primeiro Pull Request!',
                '',
                `OlÃ¡ @${creator}! Seja muito bem-vindo(a) Ã  comunidade **HDEV**!`,
                '',
                'Obrigado por contribuir com seu primeiro Pull Request! ğŸš€',
                '',
                '---',
                '',
                '### ğŸ” PrÃ³ximos Passos',
                '',
                '- Aguarde a revisÃ£o da equipe',
                '- Responda aos comentÃ¡rios se houver solicitaÃ§Ãµes de mudanÃ§a',
                '- Continue contribuindo!',
                '',
                '---',
                '',
                '**Obrigado por fazer parte da HDEV! ğŸ’ª**'
              ].join('\n');
              
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.pull_request.number,
                body: welcomeMessage
              });
            }
            
            console.log('âœ… Mensagem de boas-vindas enviada para primeira contribuiÃ§Ã£o!');


